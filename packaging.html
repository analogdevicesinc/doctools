<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Packaging pipeline &#8212; Doctools  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="_static/app.min.css?v=9cb8e28d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script defer="" src="_static/app.umd.js?v=dcfbb431"></script>
    <link rel="icon" href="_static/icon.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sphinx theme" href="theme.html" />
    <link rel="prev" title="Documentation deployment" href="ci.html" />
   
  
  <meta name="repository" content="doctools">
  <meta name="version" content="main">
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head><body>
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button value="search" class="icon"></button>
      <span id="search-progress"></span>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com"></a>
        <div class="vertical-divider"></div>
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        <a id="logo" href="index.html">
          <div>Doctools</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="./index.html" class="current">Doctools</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div>
          <div class="localtoc-header"></div>
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">Packaging pipeline</a><ul>
<li><a class="reference internal" href="#running-the-continuous-integration-locally">Running the continuous integration locally</a><ul>
<li><a class="reference internal" href="#using-act-with-podman-and-wsl2">Using act with podman and wsl2</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="no-logo" href="index.html">
      Doctools
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="./index.html" class="current">Doctools</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html">Fundamentals</a></li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1"/><div class="collapse"><a class="reference internal" href="docs_guidelines/index.html">Documentation guidelines</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="docs_guidelines/directives.html">Custom directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="docs_guidelines/roles.html">Custom roles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Documentation deployment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Packaging pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="theme.html">Sphinx theme</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body" role="main">
            
  <section id="packaging-pipeline">
<span id="packaging"></span><h1>Packaging pipeline<a class="headerlink" href="#packaging-pipeline" title="Link to this heading"></a></h1>
<p>Doctools has a continuous deployment integration pipeline that works as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                   ┌──────────────────┐
                ┌─►│Build Doc Latest  ├─┐
                │  └──────────────────┘ │
                │                       │
┌─────────────┐ │  ┌────────────────┐   │  ┌──────────────┐
│Build Package├─┼─►│Build Doc on Min├───┼─►│Deploy Package│
└─────────────┘ │  └────────────────┘   │  └──────────────┘
                │                       │
                │  ┌─────┐              │
                └─►│Tests├──────────────┘
                   └─────┘
</pre></div>
</div>
<p>The Build Package step “compiles” JavaScript and SASS, fetches third-party
assets and licenses and generates the Python package.</p>
<p>Then, in the middle-stage, two parallel runs are launched:</p>
<ul class="simple">
<li><p><em>Build Doc Latest</em>: uses the latest stable dependencies releases to
generate this documentation, and store as an artifact.</p></li>
<li><p><em>Build Doc on Min</em>: uses the minimum requirements dependencies to generate
this documentation, but the output is discarded.</p></li>
<li><p><em>Tests</em>: run tests using <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, in special, methods that are not called
during the <em>Build Doc *</em> pipelines.</p></li>
</ul>
<p>Both of them are set to fail-on-warning during the documentation generation.</p>
<p>Finally, the Deploy Package:</p>
<ul class="simple">
<li><p>Grabs the version and checks if the tag version already exists:</p>
<ul>
<li><p>If so, set to update the symbolic <code class="docutils literal notranslate"><span class="pre">pre-release</span></code> release.</p></li>
<li><p>If not, set to update the symbolic <code class="docutils literal notranslate"><span class="pre">latest</span></code> and <code class="docutils literal notranslate"><span class="pre">pre-relase</span></code> release.</p></li>
</ul>
</li>
<li><p>Still if a new version:</p>
<ul>
<li><p>Create the git tag and push to origin.</p></li>
<li><p>Create the tagged release.</p></li>
<li><p>Upload the artifact to the tagged release.</p></li>
</ul>
</li>
<li><p>Upload the artifact to the symbolic release (<code class="docutils literal notranslate"><span class="pre">pre-release</span></code>, <code class="docutils literal notranslate"><span class="pre">latest</span></code>).</p></li>
<li><p>Finally, the <em>Build Doc Latest</em> artifact is downloaded and deployed to the
branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code></p></li>
</ul>
<p>By design, the live page on <em>github.io</em> follows the pre-release/latest commit-ish;
properly versioned live documentation should be managed by an external system
that watches the git tags (e.g.
<a class="reference external" href="https://github.com/readthedocs/readthedocs.org">readthedocs</a>).</p>
<p>This approach allows to have a single defined version on <code class="docutils literal notranslate"><span class="pre">adi_doctools/__init__.py</span></code>,
and have the tags created and releases created/updated without much fuzz.</p>
<p>The philosophy is to have <code class="docutils literal notranslate"><span class="pre">latest</span></code> updated on tag increment and first
successful run, and <code class="docutils literal notranslate"><span class="pre">pre-relese</span></code> updated on successful run without tag change.
These releases exist to provide a pointer to the latest/pre-release packages, e.g.
<a class="reference external" href="https://github.com/analogdevicesinc/doctools/releases/download/latest/adi-doctools.tar.gz">releases/download/latest/adi-doctools.tar.gz</a>.</p>
<p>Non-handled corner-cases mitigations:</p>
<ul class="simple">
<li><p>Release <code class="docutils literal notranslate"><span class="pre">pre-release</span></code> and <code class="docutils literal notranslate"><span class="pre">latest</span></code> must exist prior the first run.</p></li>
<li><p>Branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> must exist with at least one commit.</p></li>
</ul>
<section id="running-the-continuous-integration-locally">
<span id="act"></span><h2>Running the continuous integration locally<a class="headerlink" href="#running-the-continuous-integration-locally" title="Link to this heading"></a></h2>
<p>The doctools CI is compatible with <a class="reference external" href="https://github.com/nektos/act/">act</a>,
a go cli that allows to run GitHub actions locally:</p>
<div class="code-shell"><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>act<span class="w"> </span>--remote-name<span class="w"> </span>public
</pre></div>
</div>
<div class="clear-left"></div></div><div><div class="no-select highlight-text notranslate"><div class="highlight"><pre><span></span>INFO[0000] Using docker host &#39;unix:///run/user/1000//podman/podman.sock&#39;,
           and daemon socket &#39;unix:///run/user/1000//podman/podman.sock&#39;
INFO[0000] Start server on http://10.44.3.54:34567
[build-package/build-package.yml/build] ⭐ Run Set up job
[...]
</pre></div>
</div>
<div class="clear-left"></div></div></div><p>Update <code class="docutils literal notranslate"><span class="pre">public</span></code> with your preferred origin name.
Additional arguments are added from the <a class="icon git reference external" href="https://github.com/analogdevicesinc/doctools/tree/main/.actrc">.actrc</a> on invoke.</p>
<p>To run a specific workflow, use <code class="docutils literal notranslate"><span class="pre">-W</span></code>, e.g.:</p>
<div class="code-shell"><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>act<span class="w"> </span>--remote-name<span class="w"> </span>public<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-W<span class="w"> </span>.github/workflows/build-package.yml
</pre></div>
</div>
<div class="clear-left"></div></div></div><section id="using-act-with-podman-and-wsl2">
<span id="act-podman"></span><h3>Using act with podman and wsl2<a class="headerlink" href="#using-act-with-podman-and-wsl2" title="Link to this heading"></a></h3>
<p>Below are suggested instructions for setting up <code class="docutils literal notranslate"><span class="pre">ack</span></code> with <code class="docutils literal notranslate"><span class="pre">podman</span></code> on a
Linux system running under WSL2.</p>
<p>Adjust to your preference as needed, and skip the steps marked in <span class="green">green</span>
if not using WSL2.</p>
<p><span class="green">Ensure cgroup v2 on wsl2’s .wslconfig:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">wsl2</span><span class="p">]</span>
<span class="n">kernelCommandLine</span> <span class="o">=</span> <span class="n">cgroup_no_v1</span><span class="o">=</span><span class="nb">all</span> <span class="n">systemd</span><span class="o">.</span><span class="n">unified_cgroup_hierarchy</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p><span class="green">Restart wsl2.</span></p>
<p>Enable podman service for your user.</p>
<div class="code-shell"><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>--user<span class="w"> </span>podman.socket
</pre></div>
</div>
<div class="clear-left"></div></div><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>start<span class="w"> </span>--user<span class="w"> </span>podman.socket
</pre></div>
</div>
<div class="clear-left"></div></div></div><p>Set the <code class="docutils literal notranslate"><span class="pre">DOCKER_HOST</span></code> variable on your <em>~/.bashrc</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_HOST</span><span class="o">=</span>unix://<span class="nv">$XDG_RUNTIME_DIR</span>/podman/podman.sock
</pre></div>
</div>
<p>Fetch <code class="docutils literal notranslate"><span class="pre">ack</span></code> binary into an executable path:</p>
<div class="code-shell"><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/.local/bin/
</pre></div>
</div>
<div class="clear-left"></div></div><div><div class="no-select float-left highlight-default notranslate"><div class="highlight"><pre><span></span>~/.local/bin$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">&#39;=https&#39;</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/nektos/act/master/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sudo<span class="w"> </span>bash
</pre></div>
</div>
<div class="clear-left"></div></div></div></section>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="ci.html" title="Previous document (Alt+Shift+LeftArrow)" class="prev">Documentation deployment</a>
    <a href="theme.html" title="Next document (Alt+Shift+RightArrow)" class="next">Sphinx theme</a>
              </div>
          
        </div>
      </div>
  </div>

  <div id="vertical-border"></div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2024, Analog Devices, Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>